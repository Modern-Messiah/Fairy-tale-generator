# üìö Fairy Tale Generator

**–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–µ—Ç—Å–∫–∏—Ö —Å–∫–∞–∑–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞**

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
- **Python API** - –±—ç–∫–µ–Ω–¥ –Ω–∞ FastAPI —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π OpenAI GPT
- **Yii2 Frontend** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ PHP —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ Yii2

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫–∞–∑–æ–∫** —á–µ—Ä–µ–∑ OpenAI GPT-4o-mini
- **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∫–∞–∑–∞—Ö—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤
- **–ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø
- **Streaming –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞–∑–æ–∫** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–º–∏ –∏—Å—Ç–æ—Ä–∏—è–º–∏
- **Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker –∏ Docker Compose
- OpenAI API –∫–ª—é—á

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
git clone <repository-url>
cd Fairy-tale-generator
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OpenAI API

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ `python-story-api/`:

```bash
cp python-story-api/.env.example python-story-api/.env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `python-story-api/.env`:
```env
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o-mini
API_HOST=0.0.0.0
API_PORT=8000
LOG_LEVEL=INFO
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
cd yii2-app
docker-compose up -d
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –í–æ–π—Ç–∏ –≤ PHP –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it yii-php bash

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
composer install

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
php yii migrate --interactive=0

# –í—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
exit
```

---

## –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å–∞–º:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-----|----------|
| **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** | http://localhost:8000 | –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∫–∞–∑–æ–∫** | http://localhost:8000/story | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–∫–∞–∑–æ–∫ |
| **Python API** | http://localhost:8001 | API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |
| **phpMyAdmin** | http://localhost:8081 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î |
| **API Docs** | http://localhost:8001/docs | Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |

**–î–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ phpMyAdmin:**
- –õ–æ–≥–∏–Ω: `root`
- –ü–∞—Ä–æ–ª—å: `root`

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Fairy-tale-generator/
‚îú‚îÄ‚îÄ python-story-api/          # Python FastAPI –±—ç–∫–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ app/                   # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ API
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile             # Docker –æ–±—Ä–∞–∑ Python
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt       # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
‚îú‚îÄ‚îÄ yii2-app/                  # Yii2 —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ modules/story/         # –ú–æ–¥—É–ª—å —Å–∫–∞–∑–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ config/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml     # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
‚îî‚îÄ‚îÄ README.md                  # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Yii2)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫–∞–∑–∫–∏
- –í—ã–±–∏—Ä–∞–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç, —è–∑—ã–∫, –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –±—ç–∫–µ–Ω–¥

### 2. API —Å–ª–æ–π (Python FastAPI)
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è OpenAI GPT
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç AI

### 3. –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (OpenAI)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å–∫–∞–∑–∫—É
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç –∏ —è–∑—ã–∫–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### 4. –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –¢–µ–∫—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ streaming
- –ì–æ—Ç–æ–≤–∞—è —Å–∫–∞–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –î–æ—Å—Ç—É–ø–Ω–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–∫–∞–∑–æ–∫

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend (Python API)
- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **OpenAI GPT** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
- **Pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Uvicorn** - ASGI —Å–µ—Ä–≤–µ—Ä
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

### Frontend (Yii2)
- **Yii2 Framework** - PHP —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Bootstrap 5** - CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **jQuery** - JavaScript –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **Apache** - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
- **MySQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Docker Compose** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- **MySQL 8** - —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î
- **phpMyAdmin** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è MySQL

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫–∞–∑–∫–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/story
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç —Ä–µ–±–µ–Ω–∫–∞ (3-5, 6-8, 9-10 –ª–µ—Ç)
3. –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ (–†—É—Å—Å–∫–∏–π/–ö–∞–∑–∞—Ö—Å–∫–∏–π)
4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É"
6. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π

- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–∫–∞–∑–æ–∫: http://localhost:8000/story/default/history
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä: –∫–ª–∏–∫ –ø–æ –ª—é–±–æ–π —Å–∫–∞–∑–∫–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏
- –£–¥–∞–ª–µ–Ω–∏–µ: –∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

---

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ:

```bash
# Python API
cd python-story-api
python -m venv venv
source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
uvicorn app.main:app --reload

# Yii2 Frontend
cd yii2-app
composer install
php yii serve
```

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs -f php          # Yii2
docker-compose logs -f story-api    # Python API
docker-compose logs -f db           # MySQL

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Python API
```bash
cd python-story-api
pytest
```

### Yii2 Frontend
```bash
cd yii2-app
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
vendor/bin/codecept run

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
vendor/bin/codecept run functional
vendor/bin/codecept run unit
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

```bash
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Composer –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏
docker exec -it yii-php composer install --optimize-autoloader --no-dev

# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
docker exec -it yii-php php yii cache/flush-all
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# Health checks
curl http://localhost:8000                    # Yii2
curl http://localhost:8001/health             # Python API
docker exec -it yii-db mysqladmin ping -h localhost -u root -proot  # MySQL
```

---

## –ü–æ–∏—Å–∫ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **OpenAI API –∫–ª—é—á –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∫–ª—é—á–∞
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ —Å—á–µ—Ç–µ

2. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è**
   ```bash
   docker-compose down -v
   docker-compose up --build
   ```

3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞**
   ```bash
   docker-compose restart db
   docker exec -it yii-php php yii migrate
   ```

4. **Python API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**
   ```bash
   docker-compose logs story-api
   curl http://localhost:8001/health
   ```
